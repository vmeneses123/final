<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BudgetBuddy</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; padding: 20px; max-width: 400px; margin: auto; }
input, select, button { width: 100%; padding: 10px; margin: 5px 0; }
#chartContainer { margin-top: 30px; }
</style>
</head>
<body>
<h1>BudgetBuddy</h1>
<h3>Add Expense</h3>
<form id="expenseForm">
  <select id="category">
    <option value="Food">Food</option>
    <option value="Bills">Bills</option>
    <option value="Entertainment">Entertainment</option>
    <option value="Other">Other</option>
  </select>
  <input type="number" id="amount" placeholder="Amount" required />
  <button type="submit">Add Expense</button>
</form>

<h3>Total This Month: $<span id="total">0</span></h3>

<button id="resetAll">Reset All</button>
<button id="resetFood">Reset Food</button>
<button id="resetBills">Reset Bills</button>
<button id="resetEntertainment">Reset Entertainment</button>
<button id="resetOther">Reset Other</button>

<div id="chartContainer">
  <canvas id="expenseChart"></canvas>
</div>

<script>
const form = document.getElementById("expenseForm");
const totalDisplay = document.getElementById("total");
let chart;

function loadData() {
  fetch("/expenses")
    .then(res => res.json())
    .then(data => {
      totalDisplay.textContent = data.total || 0;
      const ctx = document.getElementById("expenseChart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "pie",
        data: {
          labels: data.categories.length ? data.categories : ["No data"],
          datasets: [{
            data: data.amounts.length ? data.amounts : [1],
            backgroundColor: ["#FF6384","#36A2EB","#FFCE56","#4BC0C0"]
          }]
        },
        options: {
          plugins: { legend: { display: data.categories.length > 0 } }
        }
      });
    });
}

form.addEventListener("submit", e => {
  e.preventDefault();
  const amount = document.getElementById("amount").value;
  const category = document.getElementById("category").value;
  fetch("/add", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ amount, category })
  }).then(() => {
    form.reset();
    loadData();
  });
});

function resetCategory(category) {
  fetch("/reset-category", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ category })
  }).then(() => loadData());
}

document.getElementById("resetFood").addEventListener("click", () => resetCategory("Food"));
document.getElementById("resetBills").addEventListener("click", () => resetCategory("Bills"));
document.getElementById("resetEntertainment").addEventListener("click", () => resetCategory("Entertainment"));
document.getElementById("resetOther").addEventListener("click", () => resetCategory("Other"));

document.getElementById("resetAll").addEventListener("click", () => {
  fetch("/reset-all", { method: "POST" }).then(() => loadData());
});

loadData();
</script>
</body>
</html>
